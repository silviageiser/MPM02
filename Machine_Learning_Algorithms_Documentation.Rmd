---
output:
  html_document: default
  'html_document: default': default
---
```` Markdown
---
title: "Machine_Learning_Algorithms_Documentation"
author: "Geiser, Gruen, Hefti, Kuster"
date: "11/11/2020"
output: html_document: default
---



**Machine Learning Algorithms**

**Dataset - German Housing Data**

We cleaned the origin data set: Variable rooms, bathrooms, bedrooms, floors, garages, Year_built, Year_renovated changed from decimal to integer.

We created a subset with buildings up to 20 rooms for our analysis.

##Load of the cleaned dataset

```{r, include=TRUE}
# load dataset
data <- read.csv('germany_housing_cleaned_v03.csv',header =T, sep=';', encoding='UTF-8')

# Renaming of the variable Price due to contamination of the variable name "Price" of the origin dataset when cleaning up the data
names(data)[names(data) == "X.U.FEFF.Price"] <- "Price"
head(data)

```
```{r , include = TRUE}
str(data)
colnames(data)
```

##We start with the analysis of the distribution of the variables:

- Price
- Livingspace
- Rooms

#Some Variable are highly right skewed.
#Price, Living_space, lot, rooms and more. We will use the logtransformed data in our analysis.

``` {r}
d <- density(data$Price)
plot(d)

d.log <- density(log(data$Price))
plot(d.log)

d.density <- density(log(data$Living_space))
plot(d.density)
hist(log(data$Rooms))

```


**WEEK 1**

**Linear Models**

Simple linear regression

Data Visualisation

We plot the response variable "Price" against the predictor "Living_Space" to get a first impression and grahical analysis.

```{r}
options(scipen=999) #block scientific notation

library(ggplot2)


#Living Space
ggplot(data, aes(log(Living_space), log(Price))) + geom_point() + geom_smooth(method = lm, se = F, color = 'red')
#ggplot(data, aes(log(Living_space), log(Lot))) + geom_smooth(method = lm, se =F, color = 'red')

```

It seems to be a positive relationsship between these two variables. More livingspace seems to have a higher price. So we fit a simple regession model to the data.

``` {r}
lm.log.price_living <- lm(log(data$Price) ~ log(data$Living_space))
print(summary(lm.log.price_living))
```

Before we interpret the intercept and the second coefficient, the slope, we exponentiate the values. The results are: For the intercept exp(8.17522)= 3551.84 and the slope exp(0.9028)=2.47

Therefore the interpretation would be: With a livingsspace of 0 the price would be 3551.84 EURO and with each unit increase of the livingspace the price increase by 2.47 EURO which does not make much sense.

Anyway the p-value is very small therfore we have a string evidence that the slope for livingspace ist not flat.

We therefore examine the data set graphically and consider again "Price" as response variable but as predictor "Rooms" and we fit the model again with a simple linear regression.

```` {r}
library(ggplot2)
#Rooms
ggplot(data, aes(log(Rooms), log(Price))) + geom_point()+ geom_smooth(method = lm, se = F, color= 'red')
ggplot(data, aes(log(Rooms), log(Price))) + geom_point(aes(size=Living_space, colour = factor(State)))
ggplot(data, aes(log(Rooms), log(Price))) + geom_bin2d(bins = 30)

lm.log.price_rooms <- lm(log(data$Price) ~ log(data$Rooms))
print(summary(lm.log.price_rooms))
````

``` {r}
#Living Space
ggplot(data, aes(log(Price), log(Lot))) + geom_point() + geom_smooth(method = lm, se = F, color = 'red')
#ggplot(data, aes(log(Living_space), log(Lot))) + geom_smooth(method = lm, se =F, color = 'red')
```

``` {r}
#lm.log.Lot_Price <- lm(log(data$Lot) ~ log(data$Price))
#print(summary(lm.log.Lot_Price))
```

Now we are testing the effect of the categorical variable "Type" and visualize them first with a boxplot with and one without outliers.
```{r}

# use ggplot instead - to do
par(mfrow=c(2,1))
boxplot(log(data$Price) ~ data$Type, main = 'Price ~ Type plotted with outliers')
boxplot(log(data$Price) ~ data$Type, main = 'Price ~ Type plotted WITHOUT outliers', outline=FALSE)
```


```{r}
lm.type_rooms <- lm(Price ~ Type, data = data)
summary(lm.type_rooms)
```
**WEEK 2**

**model nonlinearity**

Polynomials
Graphical analysis
``` {r}
gg.PriceRooms <- ggplot(data = data,
mapping = aes(y = log(Price),
x = Rooms)) +
geom_point()
gg.PriceRooms +
geom_smooth()

```
``` {r}
gg.PriceRooms <- ggplot(data = data,
mapping = aes(y = log(Price),
x = log(Rooms))) +
geom_point()
gg.PriceRooms +
geom_smooth()

```

``` {r}
gg.LotPrice <- ggplot(data = data,
mapping = aes(y = log(Lot),
x = log(Price))) +
geom_point()
gg.LotPrice +
geom_smooth()

```

```{r}
library(mgcv)
gam.1 <- gam(log(Price) ~ s(Rooms), data = data)
summary(gam.1)


plot(gam.1, residuals = TRUE, cex = 2)

```
``` {r}
gam.2 <- gam(log(Price) ~ log(Living_space) +
s(Rooms) + s(Garages),
data = data)
summary(gam.2)


```
``` {r}
plot(gam.2, residuals = TRUE, select = 1)

```


**WEEK 3**

**GLM**

Possion Model

```{r}
glm.rooms <- glm(Rooms ~ Type,
family = "poisson",
data = data)

summary(glm.rooms)

```

```{r}
set.seed(99)
sim.data.rooms.Poisson <- simulate(glm.rooms)
##
NROW(sim.data.rooms.Poisson)

head(sim.data.rooms.Poisson)
tail(sim.data.rooms.Poisson)

```
Visualisierung ;)
``` {r}
ggplot(mapping = aes(y = sim.data.rooms.Poisson$sim_1,
x = data$Type)) +
geom_boxplot() +
geom_hline(yintercept = 0) +
ylab("simulated no. of rooms\n(assuming Poisson dist)") +
xlab("type")
```



``` {r}


#install.packages('mltools')
library(mltools)

# Resulting bins have an equal number of observations in each group
data[, "wt2"] <- bin_data(data$Price, bins=4, binType = "quantile")

# Resulting bins are equally spaced from min to max
data[, "wt3"] <- bin_data(data$Price, bins=4, binType = "explicit")

# Or if you'd rather define the bins yourself
data[, "wt4"] <- bin_data(data$Price, bins=c(-Inf, 250, 322, Inf), binType = "explicit")
head(data)
```

``` {r}
glm.roomswt2 <- glm(Rooms ~ wt2,
family = "poisson",
data = data)

summary(glm.roomswt2)
```
``` {r}
set.seed(99)
sim.data.rooms.Poissonwt2 <- simulate(glm.roomswt2)
##
NROW(sim.data.rooms.Poissonwt2)

head(sim.data.rooms.Poissonwt2)
tail(sim.data.rooms.Poissonwt2)
```
``` {r}
library(ggplot2)
ggplot(mapping = aes(y = sim.data.rooms.Poissonwt2$sim_1,
x = data$wt2)) +
geom_boxplot() +
geom_hline(yintercept = 0) +
ylab("simulated no. of rooms\n(assuming Poisson dist)") +
xlab("Groups")
```
Binary Model
Let’s fit a binary model

``` {r}
data$MillionYes <- ifelse(data$Price > 1000000, 1, 0)
data$MillionYes

ggplot(data = data,
mapping = aes(y = MillionYes,
x = log(Living_space))) +
geom_point()
```
Let’s fit a logistic regression model and add fit to the this graph

``` {r}
ggplot(data = data,
       mapping = aes(y = MillionYes,
                     x = log(Living_space))) + 
  geom_point() +
  geom_smooth(method = "glm", 
              se = FALSE,
              method.args = list(family = "binomial")) 
```



Let's try something else



















